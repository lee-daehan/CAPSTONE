<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
   <title>달력</title>
   <style>
      .calendar {
         width: 500px;
      }

      .calendar table {
         width: 100%;
      }

      .calendar table>caption {
         font-size: larger;
         font-weight: bolder;
         color: red;
         text-align: left;
         padding: 10px 20px;
      }

      .calendar table>tbody>tr>td {
         padding: 10px 10px;
         text-align: center;
      }

      .calendar table>tbody>tr>td>span {
         display: block;
         padding: 10px 10px;
      }

      .calendar table>tbody>tr>td>span.today {
         border: 1px solid red;
         border-radius: 50%;
         color: white;
         background-color: red;
         padding: 9px 9px;
      }

      .calendar>.calendar-header {
         position: relative;
         height: 50px;
         margin: 0px 20px;
      }

      .calendar>.calendar-header>.calendar-yearmonth {
         position: relative;
         font-size: larger;
         font-weight: bolder;
         color: red;
         line-height: 50px;
      }

      .calendar>.calendar-header>.calendar-controls {
         position: absolute;
         top: 11px;
         right: 0px;
      }

      .calendar>.calendar-header>.calendar-controls>button {
         float: left;
         width: 25px;
         height: 28px;
         padding: 1px 4px 0 4px;
         border: 1px solid #cbcbcb;
         background-color: #fff;
         font-size: 12px;
         cursor: pointer;
      }

      .calendar>.calendar-header>.calendar-controls>button.calendar-today {
         width: 40px;
      }
   </style>
   <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
</head>

<body>
   <div class="calendar">
      <div class="calendar-header">
         <!-- <span class="calendar-yearmonth" id="year" data-id="<%=  %>"></span> -->
         <span class="calendar-yearmonth"></span>
         <div class="calendar-controls">
            <button type="button" class="calendar-prev">&lt;</button>
            <button type="button" class="calendar-next">&gt;</button>
            <button type="button" class="calendar-today">오늘</button>
         </div>
      </div>
      <div id="calendar"></div>
   </div>
   <script>
      // 날짜 클릭
      // $(document).on("click", ".calendar table > tbody > tr > td > span", function (e) {
      //    // var yearmonth = $(".calendar-yearmonth").text().split(".");
      //    // var clickvalue = yearmonth[0] + "." + yearmonth[1] + "." + $(e.target).text();
      //    // clickvalue =  JSON.stringify(clickvalue);
      //    var v;
      //    var day = $('#day').val();
      //    day = JSON.stringify(day);
         
      //    // var day = $("#year").html()+"." + $(e.target).text();
      //    // var day = calendar(new Date());
      //    // console.log(day);
      //    // console.log(clickvalue);
      //    // console.log(e.target);
      //   $.ajax({
      //     method : 'POST',
      //     url : '/calendar',
      //     data : {date : day}
      //   }).done(function(result){
      //     v=data;
      //     console.log(data);
      //   }).fail(function(xhr, textStatus, errorThrow){
      //     //요청 실패시
      //     console.log(xhr, textStatus, errorThrow);
      //   });
      //   return v;
      // });



      /////////////////////////////대한이꺼
      // 날짜 클릭
      $(document).on("click", ".calendar table > tbody > tr > td > span", function (e) {
         var yearmonth = $(".calendar-yearmonth").text().split(".");
         var clickvalue = yearmonth[0] + "." + yearmonth[1] + "." + $(e.target).text();
         // console.log(clickvalue);
         fetch("/calendar", {
            method: "POST",
            headers: {
               "Content-Type": "application/json"
            },
            body: JSON.stringify({date : clickvalue})
         })
         .then(res => {
            if(res.status==200) {
               res.text().then(text=>console.log(text))
            }
            else{
               console.log(res.statusText)
            }
         })
         .catch(err=>console.log(err));
      });

      // 이전 달 이동 버튼 클릭
      $(".calendar-controls > .calendar-prev").on("click", function () {
         var yearmonth = $(".calendar-yearmonth").text().split(".");
         calendar(new Date(parseInt(yearmonth[0]), parseInt(yearmonth[1]) - 2, 1));
      });

      // 다음 달 이동 버튼 클릭
      $(".calendar-controls > .calendar-next").on("click", function () {
         var yearmonth = $(".calendar-yearmonth").text().split(".");
         calendar(new Date(parseInt(yearmonth[0]), parseInt(yearmonth[1]), 1));
      });

      // 오늘 이동 버튼 클릭
      $(".calendar-controls > .calendar-today").on("click", function () {
         calendar(new Date());
      });
      function calendar(date) {
         // 달력 연도
         var calendarYear = date.getFullYear();
         // 달력 월
         var calendarMonth = date.getMonth() + 1;
         // 달력 일
         var calendarToday = date.getDate();

         var monthLastDate = new Date(calendarYear, calendarMonth, 0);
         // 달력 월의 마지막 일
         var calendarMonthLastDate = monthLastDate.getDate();

         var monthStartDay = new Date(calendarYear, date.getMonth(), 1);
         // 달력 월의 시작 요일
         var calendarMonthStartDay = monthStartDay.getDay();

         // 주 카운트   
         var calendarWeekCount = Math.ceil((calendarMonthStartDay + calendarMonthLastDate) / 7);

         // 년월
         $(".calendar-yearmonth").html(calendarYear + "." + calendarMonth);

         // 오늘
         var today = new Date();

         var html = "";
         html += "<table>";
         html += "<thead>";
         html += "<tr>";
         html += "<th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th>";
         html += "</tr>";
         html += "</thead>";
         html += "<tbody>";
         // 위치
         var calendarPos = 0;
         // 날짜
         var calendarDay = 0;
         for (var index1 = 0; index1 < calendarWeekCount; index1++) {
            html += "<tr>";
            for (var index2 = 0; index2 < 7; index2++) {
               html += "<td>";
               if (calendarMonthStartDay <= calendarPos && calendarDay < calendarMonthLastDate) {
                  calendarDay++;
                  html += "<span";
                  if (calendarYear == today.getFullYear() && calendarMonth == today.getMonth() + 1
                     && calendarDay == today.getDate()) {
                     html += " class=\"today\"";
                  }
                  html += ">" + calendarDay + "</span>";
               }
               html += "</td>";
               calendarPos++;
            }
            html += "</tr>";
         }
         html += "</tbody>";
         html += "</table>";
         $("#calendar").html(html);
      }

      calendar(new Date());
   </script>
</body>

</html>